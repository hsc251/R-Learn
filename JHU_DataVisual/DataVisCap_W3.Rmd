---
title: "Hsin Chih Chen's Data Visual Capstone"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    theme: yeti
runtime: shiny
---


```{r Setup & Wrangle}
## Load the required Packages
library(flexdashboard)
library(tidyverse)
library(plotly)
library(shiny)
library(dplyr)
library(lubridate)

# Obtain Raw Data from Source
URL <- "https://data.cityofchicago.org/api/views/qmqz-2xku/rows.csv?accessType=DOWNLOAD"
download.file(URL,"bwq.csv",method = "curl")

# Execute Data Import while removing the missing data entries.
dat <- read.csv("bwq.csv", header = TRUE, na.strings = c("","NA","0",0)) 
dat$Measurement.Timestamp <- parse_date_time(dat$Measurement.Timestamp, "mdy_HMS")

# Rename Beach to Simplify Beach Names
beach <- recode(dat$Beach.Name, "63rd Street Beach" = "63rd Street", "Calumet Beach" = "Calumet", "Montrose Beach" = "Montrose", "Ohio Street Beach" = "Ohio Street", "Osterman Beach" = "Osterman", "Rainbow Beach" = "Rainbow")

# Replace Parameter Name after Recode
dat$Beach.Name <- beach

# Mutate with respective year and month
dat <- dat %>%
  mutate(disp_year = year(Measurement.Timestamp), disp_month = month(Measurement.Timestamp)) %>%
  select(-Transducer.Depth) %>%
  filter(Wave.Height > 0) %>%
  arrange(Measurement.Timestamp)

dat$disp_year <- as.character(dat$disp_year)
dat$disp_month <- as.character(dat$disp_month)

# Clean Data with na.values
tidy <- na.omit(dat)

# Generate the factors for filtering
turb_year <- seq(min(tidy$disp_year),max(tidy$disp_year),1)
wave_year <- c(2014, 2015, 2016, 2018, 2019, 2020, 2021)
beach_factor <- unique(tidy$Beach.Name)
```


Page 1
======


Input{.sidebar}
-----------------
### Yearly Temperature Box Chart

```{r Temperature Plot Input}
selectInput(inputId = "beach_name",
            label = "Select the beach",
            choices = beach_factor,
            multiple = FALSE,
            selected = beach_factor)

```

Column
------

Background: </br>

</br>

The data was gathered from the city of Chicago's beach data accumulated from 2013 to 2021 during the summer time. Data filtering and ensure the correct data was displayed to ensure no missing data or zeroes presented. </br>

For the data link, please see the web address below: </br>
https://data.cityofchicago.org/Parks-Recreation/Beach-Water-Quality-Automated-Sensors/qmqz-2xku </br>

</br>

This chart displays the water temperature boxplot distribution for each Chicago Beach recorded started from 2013. </br>


*Remark:* </br>
*1. The year 2013's data is incomplete, therefore the data was gathered from 2014 and onward.* </br>
*2. Only Ohio Street Beach from Chicago has the continuous data from 2017 and onward, other beaches have only collected their time up to 2016.* </br>


```{r Temperature Plot Rendering}
renderPlotly(
ggplotly(graph1 <- tidy %>%
  filter(Beach.Name %in% input$beach_name & disp_year >= "2014") %>%
  ggplot(aes(x = disp_year, y = Water.Temperature, fill = disp_year)) +
    geom_boxplot()+
      theme(axis.text.y = element_text(size = 12),
            axis.text.x = element_text(size = 12),
            axis.title = element_text(size = 12, face = "bold"),
            title = element_text(size =10, face = "bold"),
            legend.title = element_text(size = 10),
            legend.text = element_text(size = 10),
            legend.key.width = unit(0.5, 'cm'),
            legend.key.height = unit(0.5, 'cm'),
            legend.key.size = unit(0.5, 'cm')) + 
      labs(x = "Year", y = "Temperature (Celsius)", title = "Water Temperature for Selected Beach by Years"), height = 690)
)
```

Page 2
======


Input{.sidebar}
-----------------
### Wave Height Violin Chart

```{r Wave Height Plot Input}
selectInput(inputId = "year_wave",
            label = "Select the year ",
            choices = wave_year,
            multiple = FALSE,
            selected = wave_year[1])
```

Column
------
Background: </br>

</br>

The data was gathered from the city of Chicago's beach data accumulated from 2013 to 2021 during the summer time. Data filtering and ensure the correct data was displayed to ensure no missing data or zeroes presented. </br>

For the data link, please see the web address below: </br>
https://data.cityofchicago.org/Parks-Recreation/Beach-Water-Quality-Automated-Sensors/qmqz-2xku </br>

</br>

This particular chart demonstrates the violin distribution in wave height for each Chicago Beach recorded started from 2013, it shows the year temperature distribution for respective years. </br>


*Remark:* </br>
*1. The data from 2013 and 2017 is incomplete, therefore the data was gathered from 2014 and onward.* </br>
*2. Only Ohio Street Beach from Chicago has the continuous data from 2017 and onward, other beaches have only collected their time up to 2016.* </br>

```{r Wave Height Plot Rendering}
renderPlotly(
ggplotly(graph2 <- tidy %>%
           filter(disp_year == input$year_wave) %>%
           ggplot(aes(x = Beach.Name, y = Wave.Height, fill = Beach.Name)) +
           geom_violin()+ 
           theme(axis.text.y = element_text(size = 11),
                 axis.text.x = element_text(size = 11),
                 axis.title = element_text(size = 12, face = "bold"),
                 title = element_text(size =10, face = "bold"),
                 legend.title = element_text(size = 10),
                 legend.text = element_text(size = 10),
                 legend.key.width = unit(0.5, 'cm'),
                 legend.key.height = unit(0.5, 'cm'),
                 legend.key.size = unit(0.5, 'cm')) + 
           labs(x = "Chicago Beach Location", y = "Wave Height (m)", title = "Chicago's Wave Height Distribution Coparison"), height = 690)
)
```

Page 3
======

Input{.sidebar}
-----------------
### Turbidity Average Chart

```{r Turbidity Plot Input}
sliderInput(inputId = "year_turb",
            label = "Select the year ",
            min = min(turb_year),
            max = max(turb_year),
            value = turb_year[1])
```

Column
------

Background: </br>

</br>

The data was gathered from the city of Chicago's beach data accumulated from 2013 to 2021 during the summer time. Data filtering and ensure the correct data was displayed to ensure no missing data or zeroes presented. </br>

For the data link, please see the web address below: </br>
https://data.cityofchicago.org/Parks-Recreation/Beach-Water-Quality-Automated-Sensors/qmqz-2xku </br>

</br>

This particular chart demonstrates the water temperature for each Chicago Beach recorded started from 2013, it shows the average turbidity for beaches for respective years. </br>


*Remark:* </br>
*1. Only Ohio Street Beach from Chicago has the continuous data from 2017 and onward, other beaches have only collected their time up to 2016.*

```{r Turbidity Plot Rendering}
renderPlotly(
ggplotly(graph3 <- tidy %>%
           filter(disp_year == input$year_turb) %>%
           select(Turbidity,Beach.Name) %>%
           group_by(Beach.Name) %>%
           summarize(avg_turbidity = mean(Turbidity)) %>%
           ggplot(aes(x = avg_turbidity, y = Beach.Name))+
           geom_point(color = 'red', size = 2)+
           geom_segment(aes(x = 0, xend = avg_turbidity,y = Beach.Name, yend = Beach.Name), color = "blue") + 
           theme(axis.text.y = element_text(size = 11),
                 axis.text.x = element_text(size = 11),
                 axis.title = element_text(size = 12, face = "bold"),
                 title = element_text(size =13, face = "bold")) + 
           labs(y = "Chicago Beach Location", x = "Average Turbidity (NTU)", title = "Average Turbidity Level Calculated"), height = 690)
)
```
